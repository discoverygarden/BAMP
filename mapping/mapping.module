<?php
/**
 * Constants
 */
define("PERM_MAPPING_VIEW_OBJECTS", 'View Mapping Interface');

/**
 * Implements Menu Hook. Registers Menus.
 */
function mapping_menu() {
  $items['mapping'] = array(
    'title' => t('Mapping'),
    'description' => t('Mapping.'),
    'page callback' => 'mapping',
    'access arguments' => array(PERM_MAPPING_VIEW_OBJECTS),
    'type' => MENU_NORMAL_ITEM,
  );
  return $items;
}

/**
 * Implements hook_permission. Register permissions.
 *
 * @return array
 */
function mapping_permission() {
  return array(
    PERM_MAPPING_VIEW_OBJECTS  => array(
      'title' => t(PERM_MAPPING_VIEW_OBJECTS),
      'description' => t('View BAMP Mapping Interface.'),
      'restrict access' => TRUE,
    ),
  );
}

/**
 * Implements Hook Theme. Registers themes.
 *
 * @return array
 */
function mapping_theme() {
  return array(
    'mapping' => array(
      'arguments' => array('pid' => NULL),
      'template' => 'Viewer',
    ),
  );
}

function template_preprocess_mapping(array &$variables) {
  global $base_url;
}


/**
 * Renders the Viewer for a given pid if possible.
 *
 * @param string $pid
 */
function mapping($pid = NULL) {
    /* Load ExtJS */
    $path = drupal_get_path('module', 'mapping');
    $js_path = $path . '/js';
    $ext_path = $path . '/lib/ext';
    //drupal_add_js($ext_path . '/ext-all.js');
    drupal_add_js('http://maps.google.com/maps/api/js?sensor=false');
    drupal_add_js($ext_path . '/ext-all-debug-w-comments.js');
    drupal_add_css($path . '/css/Clear.css');
    drupal_add_css($ext_path . '/resources/css/ext-all-gray.css', 'theme', 'all');
    drupal_add_js($js_path . '/IncludeFirst.js');
    drupal_add_js($js_path . '/GMapPanel3.js');
    drupal_add_js($js_path . '/polygonCreator/v1/polygon.js');
    drupal_add_js($js_path . '/mapPanel.js');
    drupal_add_js($js_path . '/filterPanelElements.js');
    drupal_add_js($js_path . '/filterPanel.js');
    drupal_add_js($js_path . '/MappingInterface.js');
    drupal_add_css($path . '/css/mapping.css');
    return theme('mapping', $pid);
}
